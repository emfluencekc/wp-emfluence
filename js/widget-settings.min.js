emfluenceEmailerWidget={init:function(){$container=jQuery(".wp-emfluence"),$container.accordion({heightStyle:"content",collapsible:!0,active:!1}),jQuery(".wp-emfluence .type-selector").each(function(e,t){emfluenceEmailerWidget.fields.typeSelected(jQuery(t).parents(".type-section"))}),$container.on("change",".type-selector",function(){emfluenceEmailerWidget.fields.typeSelected(jQuery(this).parents(".type-section"))}),emfluenceEmailerWidget.initValidationRedirectField()},initValidationRedirectField:function(){var e=jQuery(".wp-emfluence .redirect-url");e.change(function(){var e=jQuery(this);""===e.val()||emfluenceEmailerWidget.validURL(e.val())?e.siblings(".validation-error").remove():0===e.siblings(".validation-error").length&&e.after('<span class="validation-error">Invalid URL format</span>')}),e.keyup(function(){var e=jQuery(this);0!==e.siblings(".validation-error").length&&(""===e.val()||emfluenceEmailerWidget.validURL(e.val()))&&e.siblings(".validation-error").remove()}),e.each(function(){var e=jQuery(this);0===e.siblings(".validation-error").length&&(""===e.val()||emfluenceEmailerWidget.validURL(e.val())||e.after('<span class="validation-error">Invalid URL format</span>'))})},validURL:function(e){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},groups:{add:function(e){$widget=jQuery(e).parents(".widget"),$input=this.getInput($widget);var t=this.processValue($input.val());t&&($checkboxesContainer=this.getCheckboxesContainer($widget),$checkboxesContainer.find('input[type="checkbox"][value="'+t.id+'"]').length>0?alert(t.name+" is already in the selected groups."):($checkboxesContainer.append(this.createCheckbox($widget,t)),$input.val(null)))},getInput:function(e){return e.find(".groups input[list]")},getCheckboxesContainer:function(e){return e.find(".groups .selected")},processValue:function(e){var t=e.match(/(.+)\s\[(\d+)\]/);return!!t&&{name:t[1],id:t[2]}},createCheckbox:function(e,t){var i="groups-"+e.attr("id").slice(-1)+"-"+t.id;return'<div><label for="'+i+'">          <input id="'+i+'" type="checkbox" value="'+t.id+'" name="groups[]" checked /> '+t.name+"        </label></div>"}},fields:{add:function(e){$widget=jQuery(e).parents(".widget"),$input=this.getInput($widget);var t=$input.val(),i=$input.find("option:selected").data("settings");if(!t||!i)return console.error("Field not found.");$container=this.getContainer($widget),$container.find('[data-variable-key="'+t+'"]').length>0?alert(i.name+" is already in the selected contact fields."):($container.append(this.createSection($widget,t,i)),$input.val(null))},getInput:function(e){return e.find(".basic-fields-adder select")},getContainer:function(e){return e.find(".basic_contact_fields")},getCustomTemplate:function(e){return e.find(".basic_contact_field_template").html()},createSection:function(e,t,i){var n=1;e.find(".basic_contact_fields .contact-field input.order").each(function(e,t){var i=parseInt(t.value);isNaN(i)||(n=Math.max(n,i))});return this.getCustomTemplate(e).replace(new RegExp("CONTACT_FIELD_NAME","g"),i.name).replace(new RegExp("CONTACT_FIELD_KEY","g"),t).replace(new RegExp("CONTACT_FIELD_REQUIRED_MESSAGE","g"),i.required_message).replace(new RegExp("CONTACT_FIELD_LABEL","g"),i.label).replace(new RegExp("CONTACT_FIELD_ORDER","g"),n+1)},typeSelected:function(e){var t=e.find(".type-selector option:selected").text();switch(e.find(".hidden-value").hide(),t){case"hidden":e.find(".hidden-value").show()}}},variables:{add:function(e){$widget=jQuery(e).parents(".widget"),$input=this.getInput($widget);var t=$input.val();t&&($customVariablesContainer=this.getCustomVariablesContainer($widget),$customVariablesContainer.find('[data-variable-key="custom_'+t+'"]').length>0?alert(t+" is already in the selected custom variables."):($customVariablesContainer.append(this.createVariableSection($widget,t)),$input.val(null)))},getInput:function(e){return e.find(".custom-variable-adder input")},getCustomVariablesContainer:function(e){return e.find(".custom_variables")},getCustomVariablesTemplate:function(e){return e.find(".custom_variable_template").html()},createVariableSection:function(e,t){return this.getCustomVariablesTemplate(e).replace(new RegExp("CUSTOM_VARIABLE_NUMBER","g"),t)}}},jQuery(function(){$=jQuery,emfluenceEmailerWidget.init(),$(document).ajaxSuccess(emfluenceEmailerWidget.init)});